webpackJsonp([19],{"5sPr":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("Dd8w"),n=i.n(s),a=i("NYxO"),r=i("2sLL"),o=i("gyMJ"),c=i("+4yL"),p=i("o0rJ"),u=i("mHYM"),l=i("jNWb"),m=(n()({},Object(a.b)({sleepDate:function(e){return e.prescriptions.data},meta:function(e){return e.prescriptions.meta},bedTime:function(e){return e.prescriptions.bedTime},wakingTime:function(e){return e.prescriptions.wakingTime},recommendedSleepTime:function(e){return e.prescriptions.recommendedSleepTime}}),{submitBedTime:function(){return this.meta.prescription.data?this.meta.prescription.data.sleep_at:this.initTime(this.bedTime)},submitWakingTime:function(){return this.meta.prescription.data?this.meta.prescription.data.get_up_at:this.initTime(this.wakingTime)}}),r.a,c.a,l.a,{name:"generation-prescription",computed:n()({},Object(a.b)({sleepDate:function(e){return e.prescriptions.data},meta:function(e){return e.prescriptions.meta},bedTime:function(e){return e.prescriptions.bedTime},wakingTime:function(e){return e.prescriptions.wakingTime},recommendedSleepTime:function(e){return e.prescriptions.recommendedSleepTime}}),{submitBedTime:function(){return this.meta.prescription.data?this.meta.prescription.data.sleep_at:this.initTime(this.bedTime)},submitWakingTime:function(){return this.meta.prescription.data?this.meta.prescription.data.get_up_at:this.initTime(this.wakingTime)}}),data:function(){return{isShowPicker:!1,pickerType:"bedTime",warningTip:!1,wakeUpLateDialog:!1,wakeUpTime:"",changeTime:0,pickerOptions:{title:"上床时间",data:{itemList:[[""],["."],[""]],model:[]}}}},components:{XButton:r.a,PickerSleepDoctor:c.a,SleepDialog:l.a},created:function(){},methods:{wakeUpLateDialogOk:function(){this.wakeUpLateDialog=!1,this.$store.commit("prescriptions/SET_WAKINGTIME",this.changeTime),this.isShowPicker=!1},pickerChange:function(e){var t=e;this.changeTime=3600*Number(t[0])+60*Number(t[2])},wakeUpLateDialogNo:function(){this.wakeUpLateDialog=!1},upData:function(){var e=this;o.a.delete("sleep-prescriptions/"+this.meta.prescription.data.id).then(function(t){2===Object(u.a)()?(Object(p.a)(function(e){e.callHandler("showToast",{type:"text",message:"更新成功",duration:1e3})}),Object(p.a)(function(e){e.callHandler("sleepPrescriptionUpdated",{code:1,result:t.data})}),e.$router.go(0)):(e.$vux.toast.text("更新成功"),e.$router.go(0))}).catch(function(t){2===Object(u.a)()&&Object(p.a)(function(e){e.callHandler("showToast",{type:"text",message:t.message,duration:1e3})}),e.$vux.toast.text(t.message)})},submit:function(){var e=this;o.a.post("sleep-prescriptions",{sleep_at:this.initTime(this.bedTime),get_up_at:this.initTime(this.wakingTime),sleep_duration_avg:this.meta.prescription.sleep_duration_avg_new},{headers:{Accept:"application/vnd.sd.v2+json"}}).then(function(t){2===Object(u.a)()?(Object(p.a)(function(e){e.callHandler("showToast",{type:"text",message:"设置成功",duration:1e3})}),Object(p.a)(function(e){e.callHandler("sleepPrescriptionUpdated",{code:0,result:t.data})}),e.$router.go(0)):(e.$vux.toast.text("设置成功"),e.$router.go(0))}).catch(function(t){2===Object(u.a)()&&Object(p.a)(function(e){e.callHandler("showToast",{type:"text",message:t.message,duration:1e3})}),e.$vux.toast.text(t.message)})},onPickerHide:function(){this.isShowPicker=!1},changePicker:function(e){e.data[0]=parseInt(e.data[0]);var t=3600*Number(e.data[0])+60*Number(e.data[2]);"bedTime"===this.pickerType?(this.$store.commit("prescriptions/SET_BEDTIME",t),this.recommendedSleepTime===this.bedTime?this.warningTip=!1:this.warningTip=!0):(this.warningTip=!1,this.wakeUpTime=e.data[0]+":"+e.data[2],t>=43200?this.wakeUpLateDialog=!0:this.$store.commit("prescriptions/SET_WAKINGTIME",t)),this.isShowPicker=!1},showPicker:function(e){if(!this.meta.prescription.status)if(this.isShowPicker=!0,this.pickerType=e,"bedTime"===e){this.pickerOptions.title="上床时间";var t=this.recommendedSleepTime;t<0&&(t=86400+t);var i=(t=this.$moment.duration(t,"s")).get("hours"),s=t.get("minutes"),n=i-1,a=i+1;n=n>=0?n:Number(n)+24,a=a>=24?Number(a)-24:a;var r=[];[n,i,a].forEach(function(e){r.push({value:e+"h",name:e>=0?e:Number(e)+24}),r.push({value:"."+e,parent:e+"h",name:"."})}),this.initArr(s,59).forEach(function(e){r.push({value:e.toString(),parent:"."+n,name:e.toString()})}),this.initArr(0,59).forEach(function(e){r.push({value:e.toString(),parent:"."+i,name:e.toString()})}),this.initArr(0,s).forEach(function(e){r.push({value:e.toString(),parent:"."+a,name:e.toString()})});var o=this.bedTime;o<0&&(o=86400+o);var c=(o=this.$moment.duration(o,"s")).get("hours"),p=o.get("minutes"),u={columns:3,itemList:r,model:[c+"h","."+c,p<10?"0"+p:p.toString()]};this.pickerOptions.data=u}else{this.pickerOptions.title="起床时间";var l=this.wakingTime;l<0&&(l=86400+l);var m=this.$moment.duration(l,"s"),d=m.get("hours"),h=m.get("minutes"),v={itemList:[this.initArr(0,23),["."],this.initArr(0,59)],model:[d<10?"0"+d:d,".",h<10?"0"+h:h.toString()]};this.pickerOptions.data=v}},initArr:function(e,t){for(var i=[],s=e;s<=t;s++)s<10&&(s="0"+s),i.push(s);return i},initTime:function(e){var t=e;t<0&&(t=86400+t);var i=(t=this.$moment.duration(t,"s")).get("hours"),s=t.get("minutes");return(i<=0?"00":i<10?"0"+i:i)+":"+(s<=0?"00":s<10?"0"+s:s)}}}),d={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.meta.prescription?i("div",{staticClass:"generation-prescription"},[i("div",{staticClass:"title"},[e._v("我的睡眠处方")]),e._v(" "),i("div",{staticClass:"description"},[e._v("系统已根据您的睡眠日记规划处方，请坚持")]),e._v(" "),i("div",{staticClass:"label",staticStyle:{"margin-top":"0"}},[e._v("起床时间")]),e._v(" "),i("div",{staticClass:"picker_wrapper time",on:{click:function(t){e.showPicker("wakingTime")}}},[e._v("\n    "+e._s(e.submitWakingTime)+"\n    "),!e.meta.prescription.status||e.meta.update?i("span",{staticClass:"edit"},[i("svg-icon",{attrs:{"icon-class":"sleepprescription_icon_modify"}})],1):e._e()]),e._v(" "),i("div",[i("div",{staticClass:"label",staticStyle:{"margin-top":"1.2rem"}},[e._v("上床时间")]),e._v(" "),i("div",{staticClass:"picker_wrapper time",on:{click:function(t){e.showPicker("bedTime")}}},[e._v("\n      "+e._s(e.submitBedTime)+"\n      "),!e.meta.prescription.status||e.meta.update?i("span",{staticClass:"edit"},[i("svg-icon",{attrs:{"icon-class":"sleepprescription_icon_modify"}})],1):e._e()])]),e._v(" "),e.warningTip?i("div",{staticClass:"warning"},[i("svg-icon",{staticStyle:{"margin-right":".1rem"},attrs:{"icon-class":"toast_icon_caveat"}}),e._v("\n    系统建议就寝时间为 "+e._s(e.initTime(e.recommendedSleepTime))+"\n  ")],1):e._e(),e._v(" "),i("picker-sleep-doctor",{attrs:{title:e.pickerOptions.title,submitText:"确定",dataSource:e.pickerOptions.data},on:{"on-change":e.pickerChange,"on-submit":e.changePicker,"on-hide":e.onPickerHide},model:{value:e.isShowPicker,callback:function(t){e.isShowPicker=t},expression:"isShowPicker"}}),e._v(" "),e.meta.prescription.status?e.meta.update?i("x-button",{staticClass:"isWeekTip-submit",attrs:{type:"primary"},nativeOn:{click:function(t){return e.upData(t)}}},[e._v("\n    更新处方\n  ")]):e._e():i("x-button",{staticClass:"isWeekTip-submit",attrs:{type:"primary"},nativeOn:{click:function(t){return e.submit(t)}}},[e._v("\n    确认执行\n  ")]),e._v(" "),i("sleep-dialog",{attrs:{title:"起床时间设置较晚",content:"你确定要在"+e.wakeUpTime+"起床吗",cancelText:"否",submitText:"是"},on:{handleOk:e.wakeUpLateDialogOk,handleNo:e.wakeUpLateDialogNo},model:{value:e.wakeUpLateDialog,callback:function(t){e.wakeUpLateDialog=t},expression:"wakeUpLateDialog"}})],1):e._e()},staticRenderFns:[]};var h=i("VU/8")(m,d,!1,function(e){i("WmYO")},null,null).exports,v=i("aQR8"),k=(n()({},Object(a.b)({sleepDate:function(e){return e.prescriptions.data},meta:function(e){return e.prescriptions.meta},fatigueAddTime:function(e){return e.prescriptions.fatigueAddTime}})),r.a,l.a,c.a,{name:"prescription-weekly-review",computed:n()({},Object(a.b)({sleepDate:function(e){return e.prescriptions.data},meta:function(e){return e.prescriptions.meta},fatigueAddTime:function(e){return e.prescriptions.fatigueAddTime}})),watch:{sleepDate:function(e){var t=this;if(e){var i=0;if(this.weeks=[],e.forEach(function(e){console.log(e),0!==e.id&&i++,t.weeks.push(e)}),i<3)for(var s=2;s<5;s++)if(0===e[s].id){2===s&&0===e[s+1].id?this.isWeekTip=s+1:this.isWeekTip=s;break}}},meta:function(e){if(e){var t=e.real_sleep_duration_avg;t=this.$moment.duration(t,"s"),console.log(t.get("hours"),t.get("minutes"));var i=t.get("hours"),s=t.get("minutes");this.sleep_duration_avg=(i<=0?"":i+"小时")+(s<=0?"":s+"分钟")}}},components:{XButton:r.a,SleepDialog:l.a,PickerSleepDoctor:c.a},data:function(){function e(e,t){for(var i=[],s=e;s<t;s++)s<10&&(s="0"+s),i.push(s);return i}return{weeks:[],isWeekTip:null,isShowPicker:!1,isDialog:!1,wakeUpLateDialog:!1,sleep_duration_avg:"",NUMBER_TEXT:v.d,changeTime:0,wakeUpTime:"",dataPicker:{itemList:[e(0,24),["."],e(0,60)],model:[]}}},methods:{toSleep:function(e){0===e.id&&this.$router.push({path:"question?source=prescription&date="+this.$moment.unix(e.date).format("YYYY-M-D")})},wakeUpLateDialogOk:function(){this.wakeUpLateDialog=!1,this.$store.commit("prescriptions/SET_WAKINGTIME",this.changeTime),this.isShowPicker=!1,this.$parent.isStopService=!1},wakeUpLateDialogNo:function(){this.wakeUpLateDialog=!1},pickerChange:function(e){var t=e;this.changeTime=3600*Number(t[0])+60*Number(t[2])},submitPicker:function(e){console.log(e);var t=e.data;this.wakeUpTime=t[0]+":"+t[2];var i=3600*Number(t[0])+60*Number(t[2]);this.$store.commit("prescriptions/SET_WAKINGTIME",i),i>=43200?this.wakeUpLateDialog=!0:(this.$store.commit("prescriptions/SET_WAKINGTIME",i),this.isShowPicker=!1,this.$parent.isStopService=!1)},onPickerHide:function(){this.isShowPicker=!1},handleOk:function(){this.isShowPicker=!0,this.isDialog=!1,this.$store.commit("prescriptions/SET_FATIGUEADDTIME",900)},handleNo:function(){this.isDialog=!1,this.isShowPicker=!0},submit:function(){console.log(this.meta.enquire),this.meta.enquire?this.isDialog=!0:this.isShowPicker=!0}}}),g={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.meta.prescription?i("div",{staticClass:"prescription-weekly-review"},[i("P",{staticClass:"prescription-weekly-review-title"},[e._v("回顾上周睡眠日记")]),e._v(" "),e.weeks.length>0?i("p",{staticClass:"sleep-data"},[e._v("\n    睡眠数据："+e._s(e.$moment.unix(e.weeks[0].date).format("M.DD")+"-"+e.$moment.unix(e.weeks[6].date).format("M.DD"))+"\n  ")]):e._e(),e._v(" "),i("div",{staticClass:"weeks"},e._l(e.weeks,function(t){return i("span",{key:t.name,staticClass:"day"},[e._v(e._s(e.NUMBER_TEXT[e.$moment.unix(t.date).day()]))])})),e._v(" "),i("div",{staticClass:"weeks-days"},e._l(e.weeks,function(t,s){return i("div",{key:t.name,staticClass:"item"},[i("div",{staticClass:"progress",class:{active:t.sleep_efficiency},on:{click:function(i){e.toSleep(t)}}},[t.sleep_efficiency?i("span",[e._v(e._s(t.sleep_efficiency)+"%")]):i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"prescription_icon_write"}})],1),e._v(" "),6===s?i("div",{staticClass:"days-txt"},[e._v("今天")]):t.date?i("div",{staticClass:"days-txt"},[e._v(e._s(e.$moment.unix(t.date).format("DD")))]):e._e(),e._v(" "),i("transition",{attrs:{name:"fade"}},[s===e.isWeekTip?i("div",{staticClass:"tip"},[e._v("点击补充睡眠记录")]):e._e()])],1)})),e._v(" "),i("div",{staticClass:"sleep-time"},[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"record_icon_sleepduration"}}),e._v(" "),i("span",{staticClass:"title"},[e._v("平均睡眠时长")]),e._v(" "),i("span",{staticClass:"time"},[e._v(e._s(e.sleep_duration_avg))])],1),e._v(" "),e.isWeekTip?e._e():i("div",{staticClass:"sleep-tip-text"},[e._v("\n    系统将根据您近7天的睡眠记录为您计算睡眠处方，点击下方按钮获取睡眠处方。\n  ")]),e._v(" "),e.isWeekTip?i("div",{staticClass:"sleep-tip"},[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"doctor_icon_introduction"}}),e._v("\n    您近7天睡眠数据不足，建议至少填写3天睡眠日记，以便给您更好的建议。\n  ")],1):e._e(),e._v(" "),e.isWeekTip?e._e():i("x-button",{staticClass:"isWeekTip-submit",attrs:{type:"primary"},nativeOn:{click:function(t){return e.submit(t)}}},[e._v("\n    获取睡眠处方\n  ")]),e._v(" "),i("sleep-dialog",{attrs:{title:"上周日间疲劳情况调查",content:"过去一周你常常会感到日间疲惫吗？",cancelText:"否",submitText:"是"},on:{handleOk:e.handleOk,handleNo:e.handleNo},model:{value:e.isDialog,callback:function(t){e.isDialog=t},expression:"isDialog"}}),e._v(" "),i("sleep-dialog",{attrs:{title:"起床时间设置较晚",content:"你确定要在"+e.wakeUpTime+"起床吗",cancelText:"否",submitText:"是"},on:{handleOk:e.wakeUpLateDialogOk,handleNo:e.wakeUpLateDialogNo},model:{value:e.wakeUpLateDialog,callback:function(t){e.wakeUpLateDialog=t},expression:"wakeUpLateDialog"}}),e._v(" "),i("picker-sleep-doctor",{attrs:{title:"设置您的起床时间",submitText:"确定",dataSource:e.dataPicker},on:{"on-change":e.pickerChange,"on-submit":e.submitPicker,"on-hide":e.onPickerHide},model:{value:e.isShowPicker,callback:function(t){e.isShowPicker=t},expression:"isShowPicker"}})],1):e._e()},staticRenderFns:[]};var f=i("VU/8")(k,g,!1,function(e){i("s6BH")},null,null).exports,_=(n()({},Object(a.b)({sleepDate:function(e){return e.prescriptions.data},meta:function(e){return e.prescriptions.meta}})),{name:"prescription",components:{GenerationPrescription:h,WeeklyReview:f},computed:n()({},Object(a.b)({sleepDate:function(e){return e.prescriptions.data},meta:function(e){return e.prescriptions.meta}})),data:function(){return{isStopService:!0}},methods:{},created:function(){var e=this;this.$store.dispatch("prescriptions/getPrescriptions").then(function(){e.meta.prescription.data.status?e.isStopService=!0:e.isStopService=!1})}}),T={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"prescription"},[this.isStopService?t("weekly-review"):t("generation-prescription")],1)},staticRenderFns:[]};var w=i("VU/8")(_,T,!1,function(e){i("Yf5Q")},null,null);t.default=w.exports},WmYO:function(e,t){},Yf5Q:function(e,t){},s6BH:function(e,t){}});