webpackJsonp([14],{"1M7i":function(e,s){},"36tv":function(e,s){},"4uj0":function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=t("gyMJ"),n=t("Qb34"),i=t("rHil"),l=t("1DHf"),c=t("32ER"),o=(Boolean,Boolean,Boolean,{name:"x-table",props:{fullBordered:Boolean,cellBordered:{type:Boolean,default:!0},contentBordered:{type:Boolean,default:!0}}}),r={render:function(){var e=this.$createElement;return(this._self._c||e)("table",{staticClass:"vux-table",class:{"vux-table-bordered":this.fullBordered,"vux-table-no-cell-bordered":!this.cellBordered,"vux-table-no-content-bordered":!this.contentBordered}},[this._t("default")],2)},staticRenderFns:[]};var u=t("VU/8")(o,r,!1,function(e){t("WGHa")},null,null).exports,d=t("2sLL"),_=t("o0rJ"),h=t("mHYM"),p=(i.a,l.a,c.a,d.a,{name:"scale-result",components:{Group:i.a,Cell:l.a,CellBox:c.a,XTable:u,XButton:d.a},data:function(){return{scaleResult:[],score_type:[],score_table:[]}},props:["scaleData"],created:function(){var e=this;this.scaleData&&(console.log(this.scaleData),this.scaleData.result.forEach(function(s,t){e.scaleResult.push(s),e.score_type.push(e.scaleData.scale.score_type[t]),e.score_table.push(e.scaleData.scale.comments[t]);var a=e.scaleResult[t].score;e.score_table[t].map(function(e){a>=e.min_score&&a<=e.max_score&&(e.isSelect=!0)}),e.scaleResult[t].updated_at=e.$moment.unix(e.scaleResult[t].updated_at).format("YYYY.MM.DD HH:mm")}))},methods:{returnRouter:function(){2!==Object(h.a)()?this.$router.go(-1):Object(_.a)(function(e){e.callHandler("return",{})})},isQuestion:function(){localStorage.setItem("scaleIndex_"+this.$route.params.id,0),this.$parent.isQuestion="scale"}}}),m={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{attrs:{id:"scale-result"}},e._l(e.scaleResult,function(s,a){return t("div",{key:s.name},[t("group",[t("cell",[t("div",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(s.title||"评测结果"))]),e._v(" "),1===e.scaleResult.length?t("div",{staticClass:"checkbox-reset",on:{click:e.isQuestion}},[e._v("重填")]):e._e()]),e._v(" "),t("cell-box",[0===e.score_type[a]?t("div",{staticClass:"over"},[t("svg-icon",{staticStyle:{width:"100px",height:"100px"},attrs:{"icon-class":"record_h5_icon_complete"}}),e._v(" "),t("p",[e._v("已完成")])],1):t("div",{staticClass:"result"},[t("p",[e._v(e._s(s.result))]),e._v(" "),t("p",[e._v("评测分数："+e._s(s.score)+"分")])])]),e._v(" "),t("cell-box",[s?t("div",{staticClass:"scale-bottom"},[t("p",[e._v("测评时间："+e._s(s.updated_at))]),e._v(" "),t("p",[e._v("测评建议："+e._s(s.comment))])]):e._e()])],1),e._v(" "),e.score_table[a]&&e.score_table[a].length>0?t("group",[t("cell",[t("div",{attrs:{slot:"title"},slot:"title"},[e._v("测评结果对照表")])]),e._v(" "),t("div",{staticClass:"scale-sore-table"},[t("table",[t("tbody",e._l(e.score_table[a],function(s){return t("tr",{key:s.id,class:{isSelect:s.isSelect}},[t("td",[e._v(e._s(s.result))]),e._v(" "),s.min_score!==s.max_score?t("td",[e._v(e._s(s.min_score+"~"+s.max_score))]):t("td",[e._v(e._s(s.min_score))])])}))])])],1):e._e()],1)}))},staticRenderFns:[]};var v=t("VU/8")(p,m,!1,function(e){t("1M7i")},null,null).exports,f=(n.a,{name:"scale-detail",components:{scaleQuestion:n.a,scaleResult:v},data:function(){return{scaleData:null,submit:!1,scaleType:"",scalesIds:[],isQuestion:null}},computed:{isIndex:function(){if(null!==this.scaleData&&0===this.scaleData.scale_result_id)return!this.submit}},created:function(){"scales"===this.$route.params.id?(this.scaleType="scales",this.getScales()):this.getScaleDistributions()},mounted:function(){},methods:{ready:function(){this.submit=!this.submit,this.isQuestion="scale"},getScales:function(){var e=this;return a.a.get("/scale-distributions-results",{params:{scale_distributions:this.$route.query.scale_id,include:"scale.questions,scale.comments"}}).then(function(s){var t=s.data.data,a=t[0],n=[],i=[],l=[],c=[];e.scalesIds=[],t.forEach(function(s){var t=[];null!==s.result&&(s.result.title=s.scale.title,i.push(s.result),l.push(s.scale.score_type),c.push(s.scale.comments)),s.scale.questions.map(function(e){e.id=e.id+"_"+s.id,t.push({question_id:e.id,answer:""})}),e.scalesIds.push({scale_distribution_id:s.id,answers:t}),n=n.concat(s.scale.questions)}),i.length>0&&(e.isQuestion="result",a.result=i,a.scale.score_type=l,a.scale.comments=c,a.type="scales"),a.scale.questions=n,e.scaleData=a,e.scaleData.questions=n,document.title="CBTI评估报告"})},getScaleDistributions:function(e){var s=this;return a.a.get("/scale-distributions/"+(e||this.$route.params.id),{params:{include:"scale.questions,scale.comments"}}).then(function(e){var t=[],a=[],n=[];s.scaleData=e.data,null!==s.scaleData.result&&(t.push(s.scaleData.result),a.push(s.scaleData.scale.score_type),n.push(s.scaleData.scale.comments)),t.length>0&&(s.isQuestion="result",s.scaleData.result=t,s.scaleData.scale.score_type=a,s.scaleData.scale.comments=n),document.title=s.scaleData.scale.title})}}}),b={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{class:{"blue-bg":e.isIndex},attrs:{id:"scale-details"}},[e.isIndex?t("div",{staticClass:"scale-index"},[t("h1",{staticClass:"title"},[e._v("\n      "+e._s(e.scaleData.scale.title)+"\n    ")]),e._v(" "),t("p",{staticClass:"text"},[e._v("\n      "+e._s(e.scaleData.scale.description)+"\n    ")]),e._v(" "),0!==e.scaleData.doctor_id?t("p",{staticClass:"doctor"},[e._v("\n      发放医生："+e._s(e.scaleData.doctor.name)+"\n    ")]):e._e(),e._v(" "),t("div",{staticClass:"submit",on:{click:e.ready}},[e._v("\n      开始评测\n    ")])]):e._e(),e._v(" "),"scale"===e.isQuestion?t("scale-question",{attrs:{scaleQuestionData:e.scaleData.scale.questions,type:e.scaleType,scalesIds:e.scalesIds}}):e._e(),e._v(" "),"result"===e.isQuestion?t("scale-result",{attrs:{scaleData:e.scaleData}}):e._e()],1)},staticRenderFns:[]};var x=t("VU/8")(f,b,!1,function(e){t("Yo05")},null,null);s.default=x.exports},Qb34:function(e,s,t){"use strict";var a=t("mvHQ"),n=t.n(a),i=t("0YqE"),l=t("ALGc"),c=t("rHil"),o=t("3BeM"),r=t("gyMJ"),u=t("o0rJ"),d=t("mHYM"),_=(i.a,l.a,c.a,o.a,{name:"scale-question",components:{DatetimeView:i.a,XTextarea:l.a,Group:c.a,ToastPlugin:o.a},data:function(){return{scaleType:0,scaleIndex:0,answers:[],noSubmit:!1,setTimeout:null}},props:["scaleQuestionData","type","scalesIds"],created:function(){console.log(this.scaleQuestionData,"scaleQuestionData")},mounted:function(){var e=this;if(this.scaleQuestionData){this.scaleQuestionData.map(function(s){var t={question_id:s.id,answer:null};1!==s.type&&2!==s.type||(t.answer=s.default_value||"08:00"),e.answers.push(t)}),this.handleScaleType();var s=this.$route.params.id;"scales"===this.$route.params.id&&(s=this.$route.query.scale_id);var t=localStorage.getItem("answers_scale_"+s);t&&(this.answers=JSON.parse(t));var a=localStorage.getItem("scaleIndex_"+s);a&&(this.scaleIndex=JSON.parse(a))}},watch:{scaleIndex:function(e){var s=this.$route.params.id;"scales"===this.$route.params.id&&(s=this.$route.query.scale_id),localStorage.setItem("answers_scale_"+s,n()(this.answers)),localStorage.setItem("scaleIndex_"+s,n()(e))}},methods:{optionSelect:function(e,s){var t=this;this.answers[e].answer=s,this.answers.length!==this.scaleIndex+1&&(this.setTimeout||(this.setTimeout=setTimeout(function(){t.plus()},300)))},handleScaleType:function(){var e=this.scaleQuestionData[this.scaleIndex].type;this.scaleType=e||0,1===this.scaleType&&this.$refs.datetime1&&this.$refs.datetime1.render(),2===this.scaleType&&this.$refs.datetime2&&this.$refs.datetime2.render()},reduce:function(){this.scaleIndex-=1,this.handleScaleType()},plus:function(){this.scaleError()&&(this.scaleIndex+=1,this.handleScaleType(),console.log(this.answers),this.setTimeout=null)},scaleError:function(){if(!this.noSubmit){var e=this.answers[this.scaleIndex].answer;if(null===e||""===e){if(0===this.scaleType)return this.$vux.toast.text("请选择答案","middle"),!1;if(3===this.scaleType)return this.$vux.toast.text("请输入您的回答","middle"),!1}return!0}},submit:function(){var e=this;if(this.scaleError()){if(console.log(this.type,"this.type"),"cbti"===this.type)return void this.$parent.$emit("overFn","scale",this.answers);if("scales"===this.type){var s=JSON.parse(n()(this.scalesIds));return s.forEach(function(s){s.answers.forEach(function(s){e.answers.forEach(function(e){s.question_id===e.question_id&&(s.answer=e.answer)})})}),s.forEach(function(e){e.answers.map(function(e){e.question_id=e.question_id.split("_")[0]})}),void r.a.post("/scale-distributions-answers/",{answers:n()(s),chapter_id:this.$route.query.chapter_id}).then(function(s){e.$store.dispatch("GetCbtiChapters").then(function(e){console.log(e)}),console.log(s,"submit res"),2===Object(d.a)()?Object(u.a)(function(t){t.callHandler("scaleFinishFilling",{code:0,message:"成功",result:s.data}),e.$parent.getScales()}):e.$parent.getScales(),e.noSubmit=!1}).catch(function(s){console.log(s),e.noSubmit=!1})}this.noSubmit=!0,r.a.post("/scale-distributions/"+this.$route.params.id+"/answers",{include:0===Number(this.$route.query.scale_result_id)?"scale.questions":"scale.comments",answers:n()(this.answers)}).then(function(s){console.log(s,"submit res");var t=s.data.id;2===Object(d.a)()?Object(u.a)(function(a){a.callHandler("scaleFinishFilling",{code:0,message:"成功",result:s.data}),e.$parent.getScaleDistributions(t)}):e.$parent.getScaleDistributions(t),e.noSubmit=!1}).catch(function(s){console.log(s),e.noSubmit=!1})}}}}),h={render:function(){var e=this,s=e.$createElement,a=e._self._c||s;return e.scaleQuestionData?a("div",{attrs:{id:"scale-question"}},[e.scaleQuestionData?a("div",{staticClass:"question-title"},[e._v("\n    "+e._s(e.scaleQuestionData[e.scaleIndex].question)+"\n  ")]):e._e(),e._v(" "),a("div",{staticClass:"question-body"},[0===e.scaleType?a("div",{staticClass:"type-0"},[a("div",{staticClass:"options-list",class:{"center-list":!0}},e._l(e.scaleQuestionData[e.scaleIndex].options,function(s){return a("div",{key:s.id,staticClass:"option",on:{click:function(t){e.optionSelect(e.scaleIndex,s.id)}}},[a("svg-icon",{staticClass:"icon-selected",class:e.answers[e.scaleIndex].answer!==s.id?"":"active",attrs:{"icon-class":e.answers[e.scaleIndex].answer!==s.id?"login_icon_unselected":"login_icon_selected"}}),e._v("\n          "+e._s(s.content)+"\n        ")],1)}))]):e._e(),e._v(" "),1===e.scaleType?a("div",{staticClass:"type-1"},[a("DatetimeView",{ref:"datetime1",attrs:{format:"HH:mm"},model:{value:e.answers[e.scaleIndex].answer,callback:function(s){e.$set(e.answers[e.scaleIndex],"answer",s)},expression:"answers[scaleIndex].answer"}})],1):e._e(),e._v(" "),2===e.scaleType?a("div",{staticClass:"type-2"},[a("DatetimeView",{ref:"datetime2",attrs:{format:"HH:mm"},model:{value:e.answers[e.scaleIndex].answer,callback:function(s){e.$set(e.answers[e.scaleIndex],"answer",s)},expression:"answers[scaleIndex].answer"}})],1):e._e(),e._v(" "),e.scaleQuestionData&&3===e.scaleType?a("div",{staticClass:"type-3"},[a("div",{staticClass:"title"},[e._v("填写说明")]),e._v(" "),a("x-textarea",{attrs:{max:200,placeholder:"可在此处描述您的详细情况（200字以内）","show-counter":!1},model:{value:e.answers[e.scaleIndex].answer,callback:function(s){e.$set(e.answers[e.scaleIndex],"answer",s)},expression:"answers[scaleIndex].answer"}})],1):e._e(),e._v(" "),a("div",{staticClass:"jump-btn"},[a("div",{staticClass:"btn-left"},[e.scaleIndex>0?a("img",{attrs:{src:t("mhLV"),alt:""},on:{click:e.reduce}}):e._e()]),e._v(" "),a("div",{staticClass:"btn-submit"},[e.scaleQuestionData&&e.scaleIndex===e.scaleQuestionData.length-1?a("div",{on:{click:e.submit}},[e._v("\n          生成报告\n        ")]):a("p",[e._v("\n          "+e._s(e.scaleIndex+1)+"/"+e._s(e.scaleQuestionData.length)+"\n        ")])]),e._v(" "),a("div",{staticClass:"btn-right"},[e.scaleQuestionData&&e.scaleIndex<e.scaleQuestionData.length-1?a("img",{attrs:{src:t("UQqC"),alt:""},on:{click:e.plus}}):e._e()])])])]):e._e()},staticRenderFns:[]};var p=t("VU/8")(_,h,!1,function(e){t("36tv")},null,null);s.a=p.exports},WGHa:function(e,s){},Yo05:function(e,s){}});