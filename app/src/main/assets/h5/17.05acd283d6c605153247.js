webpackJsonp([17,55],{"7lFU":function(e,t){},"9UC1":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("mvHQ"),a=i.n(s),n=i("rHil"),r=i("32ER"),o=i("1DHf"),l=i("to2R"),c=i("/kga"),u=i("63CM"),d=(c.a,c.a,u.a,{name:"text-dialog",components:{XDialog:c.a},comments:{XDialog:c.a},directives:{TransferDom:u.a},data:function(){return{show:!1}},props:["isShow","title"],methods:{close:function(){this.$emit("handleHide")}}}),h={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[i("x-dialog",{staticClass:"text-dialog",model:{value:e.isShow,callback:function(t){e.isShow=t},expression:"isShow"}},[i("div",{staticClass:"title"},[e._v(e._s(e.title))]),e._v(" "),e._t("default"),e._v(" "),i("div",{staticClass:"close",on:{click:e.close}},[i("svg-icon",{staticClass:"icon-close",attrs:{"icon-class":"record_h5_ icon_delete"}})],1)],2)],1)},staticRenderFns:[]};var p=i("VU/8")(d,h,!1,function(e){i("wKWz")},null,null).exports,v=i("jNWb"),m=i("gyMJ"),_=i("DNL9"),g=(n.a,r.a,o.a,l.a,v.a,_.default,{name:"curriculum",components:{Group:n.a,CellBox:r.a,Cell:o.a,SportActionsheet:l.a,TextDialog:p,SleepDialog:v.a,WeekReview:_.default},data:function(){return{courses:[],currentCourse:{},currentChapter:{},show:!1,isLastWeekShow:!1,lastWeekSummary:"",player:null,videoOver:!1,playProgress:[],playCurrent:0,num:0,dialog:!1,exerciseIsFilled:!1,qustionAnswer:[],questionnaires:{question:"上周睡眠限制执行起来感觉怎样？",selection:["十分困难","一般","简单"]},questionnairesDialog:!1}},mounted:function(){},methods:{handleOk:function(){var e=this;0!==this.qustionAnswer.length?m.a.post("cbti-course/"+this.$route.query.cid+"/questionnaires",{data:a()(this.qustionAnswer)}).then(function(){e.questionnairesDialog=!1}).catch(function(t){t&&422===t.status_code&&e.$vux.toast.text(t.message,"middle")}):this.$vux.toast.text("请至少选择一项","middle")},selectionQustion:function(e){-1===this.qustionAnswer.indexOf(e)?(this.qustionAnswer=[],this.qustionAnswer.push(e)):this.qustionAnswer.splice(this.qustionAnswer.indexOf(e))},initVideo:function(e){var t=e.meta.video_id,i=e.meta.play_auth;(t||i)&&(null!==this.player&&(this.player.dispose(),this.player=null),this.player=new Aliplayer({id:"J_prismPlayer",showBarTime:1e4,controlBarVisibility:"click",x5_orientation:"landscape",vid:t,playsinline:!0,playauth:i,skinLayout:[{name:"H5Loading",align:"cc"},{name:"controlBar",align:"blabs",children:[{name:"playButton",align:"tl"},{name:"progress",align:"tl"},{name:"fullScreenButton",align:"tr",x:10,y:12},{name:"timeDisplay",align:"tr"}]}],cover:e.meta.video_cover,autoplay:!1,preload:!1}),this.player.on("ready",this.handleReady),this.player.on("pause",this.pause),this.player.on("ended",this.ended),this.player.on("timeupdate",this.timeupdate),this.player.on("play",this.play),this.player.on("cancelFullScreen",this.cancelFullScreen))},play:function(e){this.seek()},doubleClick:function(){var e=this.player.getStatus();null!==this.player&&("playing"===e?this.player.pause():"pause"!==e&&"init"!==e||this.player.play())},playVideo:function(){this.player.play()},nextVideo:function(){var e=this,t=this.$route.query;this.videoOver=!1,this.getCourse(t.id,t.cid).then(function(i){e.courses.map(function(i,s,a){i.id===Number(t.cid)&&(a[s+1].is_lock?e.dialog=!0:(e.$router.replace({name:"curriculum",query:{id:e.currentChapter.id,cid:a[s+1].id}}),e.currentCourse=a[s+1],document.title=a[s+1].title,e.getPlayAuth(a[s+1].id)))})})},newArray:function(e){for(var t=[],i=0;i<e.length;i++){var s=parseInt(e[i],16);if((s=s.toString(2)).length<4)for(var a=0;a<=4-s.length+1;a++)s="0"+s;(s=s.split("")).map(function(e){t.push(Number(e))})}return console.log(t),t},cancelFullScreen:function(){},updataLogs:function(){var e="";console.log(this.playProgress,"updataLogs"),this.playProgress.map(function(t,i,s){if((i+1)%4==0){var a=s.slice(i-4+1,i+1).join("");e+=parseInt(a,2).toString(16)}});var t={video_progress:e.toUpperCase(),end_point:this.playCurrent};m.a.post("/cbti-course/"+this.currentCourse.id+"/logs",t)},ended:function(e){this.updataLogs(),this.currentCourse.exercise_is_filled?this.videoOver=!0:this.nextVideo()},pause:function(){this.updataLogs()},handleReady:function(e){console.log(e,"handleReady"),this.player.play()},timeupdate:function(e){if(0===this.playProgress.length){for(var t=parseInt(this.player.getDuration()),i="",s=0;s<parseInt(t/4);s++)i+="0";console.log(i),this.playProgress=this.newArray(i)}var a=parseInt(this.player.getCurrentTime());this.playProgress[a]=1,this.playCurrent=a,this.num+=1,100===this.num&&(this.updataLogs(),this.num=0)},showCourse:function(){this.show=!0},seek:function(){console.log("续播")},changeCourse:function(e){var t=this;e.is_lock?this.$vux.toast.text("完成上节课程后解锁"):(this.videoOver=!1,this.$router.replace({name:"curriculum",query:{id:this.currentChapter.id,cid:e.id}}),this.getCourse(this.currentChapter.id,e.id).then(function(i){t.playProgress=[],t.getPlayAuth(e.id)}))},goToExercise:function(){this.$router.push({name:"exercises",query:{id:this.currentCourse.id}})},lastWeekReview:function(){var e=this;return m.a.get("/cbti-courses/"+this.currentCourse.id).then(function(t){return e.lastWeekSummary=t.data.last_chapter_summary||"",e.lastWeekSummary=e.lastWeekSummary.replace(/\n/g,"<br>"),e.isLastWeekShow=!0,t})},getPlayAuth:function(e){var t=this;return m.a.get("/cbti-courses/"+e).then(function(e){console.log(e.data.meta.exercise_is_filled,null!==e.data.meta.exercise),e.data.meta.is_pop_questionnaire&&(t.questionnairesDialog=!0,t.questionnaires=e.data.meta.questionnaire[0]),null!==e.data.meta.exercise?(e.data.meta.exercise_is_filled||(t.currentCourse.exercise_is_filled=!0),t.exerciseIsFilled=!0,t.currentCourse.cbti_course_id=e.data.meta.exercise.cbti_course_id):t.exerciseIsFilled=!1;var i=e.data;return t.initVideo(i),i.meta.course_log&&(t.playProgress=t.newArray(i.meta.course_log.video_progress)),e}).catch(function(e){console.log(e)})},getCourse:function(e,t){var i=this;return m.a.get("/cbti-chapter/"+e+"/courses").then(function(e){return e.data.data.map(function(e){e.id===parseInt(t)&&(i.currentCourse=e,document.title=i.currentCourse.title)}),i.courses=e.data.data,i.currentChapter=e.data.meta.chapter,e})}},created:function(){var e=this,t=this.$route.query;this.getCourse(t.id,t.cid).then(function(t){e.getPlayAuth(e.$route.query.cid)})}}),f={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"curriculum"},[i("div",{ref:"video",staticClass:"video",staticStyle:{overflow:"hidden"}},[i("div",{staticClass:"prism-player",attrs:{id:"J_prismPlayer"},on:{dblclick:e.doubleClick}}),e._v(" "),e.videoOver?i("div",{staticClass:"video-over"},[i("div",{staticClass:"course-title"},[e._v("本节课程结束")]),e._v(" "),i("div",{staticClass:"course-txt"},[e._v("完成随堂练习，巩固所学知识")]),e._v(" "),i("div",{staticClass:"bnts"},[i("div",{staticClass:"reload",on:{click:e.nextVideo}},[e._v("继续观看")]),e._v(" "),i("router-link",{staticClass:"over-video",attrs:{to:{path:"/cbti/exercises?id="+e.currentCourse.cbti_course_id}}},[e._v("完成练习\n        ")])],1)]):e._e()]),e._v(" "),i("div",{staticClass:"curriculum-tab"},[e.exerciseIsFilled?i("router-link",{staticClass:"item",attrs:{to:{path:"/cbti/exercises",query:{id:e.currentCourse.id}}}},[i("svg-icon",{staticClass:"item-icon",attrs:{"icon-class":"cbti_icon_exercise"}}),e._v("\n      课程练习\n    ")],1):e._e(),e._v(" "),1!==e.currentChapter.index&&1===e.currentCourse.index?i("div",{staticClass:"item",on:{click:e.lastWeekReview}},[i("svg-icon",{staticClass:"item-icon",attrs:{"icon-class":"cbti_icon_review"}}),e._v("\n      上周回顾\n    ")],1):e._e()],1),e._v(" "),i("group",{staticClass:"summary"},[i("cell",{attrs:{title:"课程总结"}},[i("span",{staticClass:"curriculum-btn",on:{click:e.showCourse}},[e._v("课程表\n        "),i("svg-icon",{staticClass:"curriculum-icon",attrs:{"icon-class":"cbti_icon_list"}})],1)]),e._v(" "),i("cell-box",[e._v(e._s(e.currentCourse.summary))])],1),e._v(" "),i("sport-actionsheet",{attrs:{showCancel:!1,customMenus:!0},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[i("div",{attrs:{slot:"header"},slot:"header"},[e._v("\n      课程列表\n    ")]),e._v(" "),i("div",{staticClass:"curriculum-lists",attrs:{slot:"menus"},slot:"menus"},e._l(e.courses,function(t){return i("div",{key:t.id,staticClass:"item",class:{slock:t.is_lock,ing:t.id===e.currentCourse.id},on:{click:function(i){e.changeCourse(t)}}},[e._v(e._s(t.title)+"\n      ")])}))]),e._v(" "),i("text-dialog",{attrs:{isShow:e.isLastWeekShow,title:"上周回顾"},on:{handleHide:function(t){e.isLastWeekShow=!1}}},[i("week-review",{attrs:{review:e.lastWeekSummary}})],1),e._v(" "),i("sleep-dialog",{attrs:{cancel:!1,title:"下节课程待开放",content:"完成本节课程学习后自动解锁下节内容"},on:{handleOk:function(t){e.dialog=!1}},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}}),e._v(" "),i("sleep-dialog",{attrs:{submitText:"提交",cancel:!1},on:{handleOk:e.handleOk},model:{value:e.questionnairesDialog,callback:function(t){e.questionnairesDialog=t},expression:"questionnairesDialog"}},[i("div",{staticClass:"cbti-questionnaires",attrs:{slot:"content"},slot:"content"},[i("div",{staticClass:"question"},[e._v(e._s(e.questionnaires.question))]),e._v(" "),i("div",{staticClass:"selection"},e._l(e.questionnaires.selection,function(t,s){return i("span",{key:t.name,class:{active:e.qustionAnswer.indexOf(s)>-1},on:{click:function(t){e.selectionQustion(s)}}},[e._v(e._s(t))])}))])])],1)},staticRenderFns:[]};var y=i("VU/8")(g,f,!1,function(e){i("7lFU")},null,null);t.default=y.exports},DNL9:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"week-review",class:{H5:this.review},domProps:{innerHTML:this._s(this.$route.query.review||this.review)}})},staticRenderFns:[]};var a=i("VU/8")({name:"week-review",props:["review"]},s,!1,function(e){i("Dbg7")},null,null);t.default=a.exports},Dbg7:function(e,t){},wKWz:function(e,t){}});