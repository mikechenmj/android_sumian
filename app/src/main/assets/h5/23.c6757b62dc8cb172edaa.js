webpackJsonp([23],{"+BHx":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("+4yL"),n=i("gyMJ"),s=i("rHil"),r=i("1DHf"),l=i("32ER"),c=i("kbG3"),o=i("wmxo"),u=(c.a,String,Boolean,Boolean,String,Number,String,Boolean,Number,Boolean,Array,{name:"x-switch",components:{InlineDesc:c.a},computed:{labelStyle:function(){var e=/<\/?[^>]*>/.test(this.title),t=Math.min(e?5:this.title.length+1,14)+"em";return Object(o.a)({display:"block",width:this.$parent.labelWidth||t,textAlign:this.$parent.labelAlign})},labelClass:function(){return{"vux-cell-justify":this.$parent&&"justify"===this.$parent.labelAlign}}},methods:{onClick:function(){this.$emit("on-click",!this.currentValue,this.currentValue)},toBoolean:function(e){return this.valueMap?1===this.valueMap.indexOf(e):e},toRaw:function(e){return this.valueMap?this.valueMap[e?1:0]:e}},props:{title:{type:String,required:!0},disabled:Boolean,value:{type:[Boolean,String,Number],default:!1},inlineDesc:[String,Boolean,Number],preventDefault:Boolean,valueMap:{type:Array,default:function(){return[!1,!0]}}},data:function(){return{currentValue:this.toBoolean(this.value)}},watch:{currentValue:function(e){var t=this.toRaw(e);this.$emit("input",t),this.$emit("on-change",t)},value:function(e){this.currentValue=this.toBoolean(e)}}}),d={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"vux-x-switch weui-cell weui-cell_switch"},[i("div",{staticClass:"weui-cell__bd"},[i("label",{staticClass:"weui-label",class:e.labelClass,style:e.labelStyle,domProps:{innerHTML:e._s(e.title)}}),e._v(" "),e.inlineDesc?i("inline-desc",[e._v(e._s(e.inlineDesc))]):e._e()],1),e._v(" "),i("div",{staticClass:"weui-cell__ft"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.currentValue,expression:"currentValue"}],staticClass:"weui-switch",attrs:{type:"checkbox",disabled:e.disabled},domProps:{checked:Array.isArray(e.currentValue)?e._i(e.currentValue,null)>-1:e.currentValue},on:{change:function(t){var i=e.currentValue,a=t.target,n=!!a.checked;if(Array.isArray(i)){var s=e._i(i,null);a.checked?s<0&&(e.currentValue=i.concat([null])):s>-1&&(e.currentValue=i.slice(0,s).concat(i.slice(s+1)))}else e.currentValue=n}}}),e._v(" "),e.preventDefault?i("div",{staticClass:"vux-x-switch-overlay",on:{click:e.onClick}}):e._e()])])},staticRenderFns:[]};var h=i("VU/8")(u,d,!1,function(e){i("dUgK")},null,null).exports,m=(s.a,r.a,l.a,a.a,{name:"setting-sleep-diary",data:function(){function e(e,t){for(var i=[],a=e;a<=t;a++)console.log(0),a<10?i.push("0"+a):i.push(a);return console.log(i),i}return{defaultTime:" 09:30",id:null,time:"",dataSource:{model:["09",":","30"],itemList:[e(0,23),[":"],e(0,59)]},sleepDiary:!1,isShowPicker:!1,reminders:{}}},methods:{getSubscriptions:function(){var e=this;return n.a.get("/reminders/subscriptions?type=2").then(function(t){if(e.reminders=t.data,0===t.data.data.length){var i=e.$moment().format("YYYY-MM-DD")+e.defaultTime,a=e.$moment(i,"YYYY-MM-DD HH:mm").unix();e.addSubscriptions({type:2,enable:0,remind_at:a}).then(function(t){e.getSubscriptions()})}else{var n=t.data.data[0].remind_at.split(":");e.dataSource.model[0]=n[0],e.dataSource.model[2]=n[1],e.time=n[0]+":"+n[1],e.id=t.data.data[0].id,1===t.data.data[0].enable&&(e.sleepDiary=!0)}})},switchChange:function(e){e?this.isShowPicker=!0:this.setSubscriptions({enable:Number(e)}),this.sleepDiary=e},setSubscriptions:function(e){var t=this;return n.a.patch("/reminders/subscriptions/"+this.id+"?type=2",e).then(function(i){t.isShowPicker=!1,t.reminders.data=[i.data],t.sleepDiary?(t.time=t.$moment.unix(e.remind_at).format("HH:mm"),t.$vux.toast.text("设置成功","middle")):t.$vux.toast.text("成功关闭","middle")})},addSubscriptions:function(e){return n.a.post("/reminders/subscriptions?type=2",e)},changePicker:function(e){var t=this.$moment().format("YYYY-MM-DD")+""+this.dataSource.model.join(""),i=this.$moment(t,"YYYY-MM-DD HH:mm").unix();this.setSubscriptions({remind_at:i,enable:Number(this.sleepDiary)})},onPickerHide:function(){0===this.reminders.data[0].enable&&(this.sleepDiary=!1),this.isShowPicker=!1}},created:function(){this.getSubscriptions()},components:{Group:s.a,Cell:r.a,CellBox:l.a,XSwitch:h,PickerSleepDoctor:a.a}}),p={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"setting-sleep-diary"},[i("group",[i("x-switch",{staticClass:"sleep-diary-switch",attrs:{title:"睡眠日记填写提醒","prevent-default":""},on:{"on-click":e.switchChange},model:{value:e.sleepDiary,callback:function(t){e.sleepDiary=t},expression:"sleepDiary"}}),e._v(" "),i("transition",{attrs:{name:"fade"}},[e.sleepDiary?i("cell-box",{attrs:{"is-link":""},nativeOn:{click:function(t){e.isShowPicker=!0}}},[i("div",{staticClass:"title"},[e._v("提醒时间")]),e._v(" "),i("div",{staticClass:"timer"},[e._v(e._s(e.time))])]):e._e()],1)],1),e._v(" "),i("p",{staticClass:"tip-text"},[e._v("开启睡眠日记填写提醒，速眠医生将会每日定时通知您填写日记。请确保APP通知权限开启。")]),e._v(" "),i("picker-sleep-doctor",{attrs:{title:"设置提醒时间",submitText:"确定",dataSource:e.dataSource},on:{"on-submit":e.changePicker,"on-hide":e.onPickerHide},model:{value:e.isShowPicker,callback:function(t){e.isShowPicker=t},expression:"isShowPicker"}})],1)},staticRenderFns:[]};var v=i("VU/8")(m,p,!1,function(e){i("IDyo")},null,null);t.default=v.exports},IDyo:function(e,t){},dUgK:function(e,t){}});